# 20-04-08

大量数据的存储计算

# Hadoop组成（面试重点）

![image-20200408103603157](https://sumomoriaty.oss-cn-beijing.aliyuncs.com/image-20200408103603157.png)

为什么要把Yarn单独提出来呢:解耦,可以支持第三方产品,提高计算效率

## HDFS架构概述

HDFS（Hadoop Distributed File System）的架构概述。

![image-20200408105702053](https://sumomoriaty.oss-cn-beijing.aliyuncs.com/image-20200408105702053.png)

NN:名称节点,哪个文件存储到了哪个机器上,统筹整体数据的存储.元数据:保存数据信息的数据,即描述真实数据的数据,对HDFS的操作,必然要经过NN

DN:存储的是真实数据

2NN:不是热备,和NN不能等价替换,NN挂了,2NN也不能代替NN,可以抢救一下,可以理解为NN的秘书,辅助NN干活

热备:两个一模一样,但同时只有一个对外提供服务

## YARN架构概述$$$

yarn就是分任务调度和资源调度

![image-20200408112809979](https://sumomoriaty.oss-cn-beijing.aliyuncs.com/image-20200408112809979.png)

NodeManager:DN管理单个结点的资源,处理RM给它安排的任务

ResourceManager:Yarn大哥,和客户端交互,整个集群的资源的管理者,要监控NM状态,分配整个集群资源的调度

为每个MR启动一个AM,启动之后就要申请资源,让RM去分配资源,AM管理MR(MapReduce)的任务,根据启动task的多少去找RM去申请,让RM去给它分配资源

(一个AM的Container是可能分配在不同的节点)都是以Container为单位,分配好的资源用一个Container做一个封装(好处:方便管理,不允许其他资源侵占我的地盘)

## MapReduce架构概述

先分再合,每个人分一部分数据,一起算,然后把算好的结果进行汇总

MapReduce将计算过程分为两个阶段：Map和Reduce

1）Map阶段并行处理输入数据:分

2）Reduce阶段对Map结果进行汇总:合

![image-20200408115452453](https://sumomoriaty.oss-cn-beijing.aliyuncs.com/image-20200408115452453.png)



![image-20200408115433495](https://sumomoriaty.oss-cn-beijing.aliyuncs.com/image-20200408115433495.png)

## Hadoop架构小结

Hadoop组成：
    HDFS  (存)
    Yarn  (资源管理和调度)
    MapReduce (算)

HDFS的组成:
    NameNode(NN) : 管理真实数据的元数据, 存数据和读数据都要经过NameNode
    DataNode(DN) : 存储真实的数据
    SecondaryNameNode(2NN) :  辅助Namenode工作,不能替换NameNode。

Yarn组成:
    资源: 每台服务器的硬件资源，例如 内存  cpu  磁盘  网络带宽等. 
    ResourceManager(RM): 管理集群中所有的资源(内存，cpu等)(每个DataNode上的资源)
    NodeManager(NM):     管理单个节点的资源(单个DataNode上的资源)
    ApplicationMaster(AM): 每个MapReduce(MR)任务会启动一个MrAppMaster, 负责为MapReduce向ResourceManager申请资源
    Container:  对资源的封装，防止资源别侵占.

    举例:  运行一个MapReduce任务,MapReduce需要启动2个MapTask 和 1个 ReduceTask，也就是总共3个Task
    
           首先会启动一个MrAppMaster ，需要用到资源，假如2G内存，此时RM会在有资源的NM上分配资源，运行MrAppMaster[此时就有1个container]
       接下来 MrAppMaster 会根据MapReduce的情况， 比如需要总共启动3个Task , MrAppMaster会向RM申请资源，假如
       一个Task需要1G的内存， RM会在有资源的NM上分配, 来运行Task. 每个Task单独运行，占用1G内存。此时又有3个Container
    
       需要解释的是 MrAppMaster和所有的Task可以运行在不同的服务器.
    
       最后当所有的Task都运行完成后， MrAppMaster会想RM注销自己. RM回收资源。

MapReduce的阶段:
	Map阶段:  数据的分
	Reduce阶段: 数据的合