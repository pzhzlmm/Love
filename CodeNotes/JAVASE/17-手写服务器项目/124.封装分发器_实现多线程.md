# 124.封装分发器_实现多线程

上节课实现的是个单线程操作,这节课实现个多线程操作<br />很多客户机访问服务器,服务器也要分别作出对应的响应,而这个响应不一定是相同的,需要针对每一个作出不同的操作<br />所以每一个都是我们需要执行的操作<br />我们重新建一个类**,**要这个类又多线程的能力<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560418246511-0b8ab63a-5163-4df6-a7ee-6faa716cce3e.png#align=left&display=inline&height=256&name=image.png&originHeight=512&originWidth=905&size=246137&status=done&width=452.5)<br />每个线程都要执行这些操作<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560418273624-78d96c2d-000c-43ce-a6e0-024e843395ba.png#align=left&display=inline&height=381&name=image.png&originHeight=762&originWidth=987&size=456304&status=done&width=493.5)<br />所以这段代码是要放在runnable当中的<br />成员变量+构造方法<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560418458746-5ebfb91f-a5b7-4340-84f8-423a3df89ac8.png#align=left&display=inline&height=273&name=image.png&originHeight=545&originWidth=1086&size=373699&status=done&width=543)<br />处理异常,出错了改状态码

接下来要根据url获取指定的servlet<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560418558139-fbb71f18-33f7-448b-9b7a-1428ca4f7ad1.png#align=left&display=inline&height=362&name=image.png&originHeight=724&originWidth=961&size=407920&status=done&width=480.5)<br />写完之后,把单线程的都删除<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560780883691-85022344-2476-4dc6-9d1d-85293dc87a9a.png#align=left&display=inline&height=342&name=image.png&originHeight=684&originWidth=991&size=345850&status=done&width=495.5)<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560780924336-7c45f0d2-e996-4cad-92c0-08d4b7bf90d8.png#align=left&display=inline&height=330&name=image.png&originHeight=659&originWidth=924&size=346862&status=done&width=462)<br />然后开始循环 ,时刻监听是否有客户发送请求<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560780976409-cf7d34c6-7f9a-4b28-9a80-e55402fef388.png#align=left&display=inline&height=195&name=image.png&originHeight=390&originWidth=832&size=133679&status=done&width=416)<br />创建线程,并开启线程对象<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560781034480-768b34bd-c72f-4ee0-862e-01bab521bdf8.png#align=left&display=inline&height=224&name=image.png&originHeight=447&originWidth=761&size=198928&status=done&width=380.5)<br />建立一个boolean变量,如果服务器没问题一直开着<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560781076766-a8fea6f6-027c-426b-ab35-746f15aff15b.png#align=left&display=inline&height=128&name=image.png&originHeight=255&originWidth=675&size=166187&status=done&width=337.5)<br />所有出错的让它isShutDown为true<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560418701629-9a17d1d4-951e-47d6-b416-fbe8be0fe34b.png#align=left&display=inline&height=227&name=image.png&originHeight=454&originWidth=728&size=221433&status=done&width=364)<br />进行请求响应出错了的话就关闭服务器就好了<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560418768309-599c21cf-aa8c-421b-8bd6-3bbda1355efa.png#align=left&display=inline&height=371&name=image.png&originHeight=742&originWidth=680&size=288736&status=done&width=340)<br />测试<br />登录成功但程序出现了个空指针异常<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560418808687-f0221b9b-5edf-45db-88e6-a10a4b20d258.png#align=left&display=inline&height=109&name=image.png&originHeight=218&originWidth=929&size=242825&status=done&width=464.5)<br />反射的时候出现了问题<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560418842244-145532a5-23e9-4809-8fe4-11df2f4276b9.png#align=left&display=inline&height=72&name=image.png&originHeight=144&originWidth=800&size=149696&status=done&width=400)<br />根据servletClass创建servlet对象的时候出现了问题<br />url出问题了,具体什么问题我们打印输出下这个问题<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560418936909-c7ea9728-27b0-44c0-a805-6d43d9832f27.png#align=left&display=inline&height=141&name=image.png&originHeight=282&originWidth=717&size=163288&status=done&width=358.5)<br />重新启动<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560418968194-8a3729e2-6a36-4d05-8ef1-1c670b8a55a1.png#align=left&display=inline&height=247&name=image.png&originHeight=494&originWidth=1168&size=452572&status=done&width=584)<br />login这个请求是正确的,因为创建了正确的对象<br />下面这个我们在我们的xml中并没有配置它<br />这个请求是浏览器发给我们的,下一章说
