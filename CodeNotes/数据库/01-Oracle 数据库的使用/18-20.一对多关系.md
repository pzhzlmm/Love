# 18-20.一对多关系

<a name="BXmic"></a>
## 4 数据库中表关系
开发之中我们会把不同数据放在不同的表当中<br />名词建表,两个表有没有关系取决于数据本身<br />设计关系数据库的一个重要部分是将数据元素划分为相关的表，我们可以根据数据本身<br />的关联性，将不同表之间的数据聚合在一起。注意：无论在表与表之间建立了什么样的关系，<br />决定数据之间是否有关系的不是表，而是数据本身。<br />表与表之间一般存在三种关系，即一对一，一对多，多对多关系。<br />所有数据库中都存在这种关系
<a name="ELy3H"></a>
### 一对多
一对多关系是建立在两张表之间的关系。一个表中的一条数据可以对应另一个表中的多<br />条数据。记住：外键永远在多方。外键允许重复，允许含有空值。<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560954428144-1f9901cc-fbc3-4f3d-9fb7-fcb9d14274fe.png#align=left&display=inline&height=141&name=image.png&originHeight=208&originWidth=433&size=22625&status=done&width=294)<br />多方要参照一方的主键,多方的值一方必须有,违反了外键约束
<a name="M3Tp0"></a>
### 例
建表<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560954618742-a8708738-aacf-4573-8939-354b3db9a174.png#align=left&display=inline&height=225&name=image.png&originHeight=450&originWidth=766&size=124091&status=done&width=383)<br />加列<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560954635478-948cd517-95b3-42c5-8f66-54a8fbacf1f0.png#align=left&display=inline&height=89&name=image.png&originHeight=177&originWidth=758&size=62318&status=done&width=379)<br />约束:根据名字知道哪里出了问题<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560954660443-3f58662c-57e8-4da7-b47b-c529d96009d8.png#align=left&display=inline&height=56&name=image.png&originHeight=112&originWidth=655&size=50389&status=done&width=327.5)<br />Tclass建立好,建立学生表,要有一方主键的列<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560954693106-f3ad5d1d-500c-4d4a-85b1-8f8d9d999326.png#align=left&display=inline&height=112&name=image.png&originHeight=223&originWidth=688&size=63588&status=done&width=344)<br />列
<a name="UU6Yz"></a>
### ![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560954735367-d1a78051-af78-453e-9fe2-3af451d694c3.png#align=left&display=inline&height=112&name=image.png&originHeight=224&originWidth=800&size=90665&status=done&width=400)
添加外键约束(现在添加什么值都可以)<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560954804248-c9e8fb05-2809-412d-8f9f-d174243f0b6e.png#align=left&display=inline&height=78&name=image.png&originHeight=156&originWidth=797&size=79022&status=done&width=398.5)<br />如果添加不存在的主键:<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560954883104-c7c675db-1874-4dcd-bc0d-03f028f9b69a.png#align=left&display=inline&height=150&name=image.png&originHeight=299&originWidth=704&size=118082&status=done&width=352)<br />(没有二班,没有对应数据)

<a name="GmzTa"></a>
### 一对一
一对一关系是建立在一对多的基础之上，外键可以在任何一方，需要让外键一方具备唯<br />一约束<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560993894701-44808c06-b3ee-40a9-8510-683969029970.png#align=left&display=inline&height=102&name=image.png&originHeight=204&originWidth=471&size=13238&status=done&width=235.5)<br />可以在一堆多的基础之上改造成一对多的关系<br />外键在哪一方都可以<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560993991404-dedc46f9-5712-4888-ade3-0f53b94c3fcd.png#align=left&display=inline&height=105&name=image.png&originHeight=210&originWidth=761&size=77162&status=done&width=380.5)<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560994035169-43f294a0-2adc-4fa1-bcdb-53f61b724f2b.png#align=left&display=inline&height=81&name=image.png&originHeight=162&originWidth=766&size=89705&status=done&width=383)
<a name="9nygC"></a>
### 多对多
需要建立一个中间表，中间表里建立两个列，然后需要用这两个列作为这个表的联合主<br />键，然后每个列在作为外键参照各自的表的主键<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560994075875-0d19eea0-9f6f-40a7-8d33-ea8487b89fe5.png#align=left&display=inline&height=119&name=image.png&originHeight=214&originWidth=666&size=41287&status=done&width=371)<br />订单商品表,一个订单可以有多个商品,一个商品可以有多个订单<br />需要一个表作为中间表,其实就是两侧的一对多的关系<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560994331135-88c27959-c4c3-4ebd-ab18-f30380d1f2f2.png#align=left&display=inline&height=204&name=image.png&originHeight=408&originWidth=1139&size=57736&status=done&width=569.5)<br />各自外键参照对方主键<br />联合主键:两个完全相同才是主键<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560994527580-89086d0f-be57-4289-9e88-1ac70c461c7d.png#align=left&display=inline&height=94&name=image.png&originHeight=188&originWidth=868&size=101383&status=done&width=434)<br />增加数据先向两个表增加数据,再向中间表增加数据,删除也同样,不然无法正常操作<br />无论是一对多还是多对多,都是要从外围数据进行操控<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560994652671-0b1bf165-2384-4018-8f28-abe28c053b99.png#align=left&display=inline&height=89&name=image.png&originHeight=178&originWidth=286&size=28525&status=done&width=143)<br />![image.png](https://cdn.nlark.com/yuque/0/2019/png/349894/1560994702011-63fd1fdb-2c2c-4459-a08f-1c815b7e262a.png#align=left&display=inline&height=123&name=image.png&originHeight=245&originWidth=935&size=94366&status=done&width=467.5)
