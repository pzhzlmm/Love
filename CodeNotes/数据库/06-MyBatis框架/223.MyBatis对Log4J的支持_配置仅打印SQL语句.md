# 223.MyBatis对Log4J的支持_配置仅打印SQL语句

<a name="ef3124cc"></a>
# MyBatis 对 log4j 的支持
Mybatis已经做好了对log4j的支持,它在封装代码的时候已经使用了log4j去记录日志了,我们只需要提供相应的jar包与配置文件就可以打印输出了<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451300979-dd6401d7-9baf-4618-a382-25a9446e58bd.png#align=left&display=inline&height=275&originHeight=315&originWidth=952&status=done&width=831)<br />如果把相应jar包导入进去却没有写相应的配置文件没有放在src目录下的话,log4j找不到这个配置文件(默认约定是在src目录下),如果说在这个目录下找到了![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451301068-3fee953a-1c0a-4c6f-b392-73fb57d2ad33.png#align=left&display=inline&height=51&originHeight=34&originWidth=165&status=done&width=248),就支持,找不到就会爆出这些经公告<br />而我们之所以要用到这个是因为mybatis把整个过程封装起来了,中间具体发生了什么事儿不清楚,如果把这个运行步骤在控制台打印一下我们就能明白它到底干了些什么事儿了<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451301140-87b01f53-ee79-426c-8ff0-315e888b2580.png#align=left&display=inline&height=163&originHeight=141&originWidth=717&status=done&width=831)<br />我们不往文件里打了,直接往控制台打就好<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451301205-6a77e843-2c8b-4659-b907-14e7216e57e2.png#align=left&display=inline&height=59&originHeight=39&originWidth=200&status=done&width=300)简单的X类?是在log4j基础上的简化<br />通过日志的打印我们就能清楚整个过程中去做了哪些事<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451301324-23c41518-8411-4735-972a-93a533b34145.png#align=left&display=inline&height=241&originHeight=775&originWidth=2668&status=done&width=831)<br />注意之所以能打印出来这么多是因为我们这里把日志的级别设置成了debug的级别<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451301449-5b681431-dac9-4b3d-b89e-1c23c06424fc.png#align=left&display=inline&height=169&originHeight=121&originWidth=595&status=done&width=831)<br />改成info一条都没了

<a name="3fbf5a03"></a>
### 局部打印
我们现在有个想法就是打印sql语句这个对我们比较重要,其他基本都是重复的,于是我们只想显示这部分代码,其他的都隐藏起来,这样看起来更为清爽<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451301533-e94b79f3-67e3-48f9-9ee3-616a2ef25bf9.png#align=left&display=inline&height=243&originHeight=255&originWidth=871&status=done&width=831)<br />首先,把整体日志级别调高<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451301606-cf1d68e3-a5d1-47b1-8d2f-e521826a4cd9.png#align=left&display=inline&height=191&originHeight=152&originWidth=662&status=done&width=831)<br />单独把sql语句的部分改成debug级别(这部分设置成debug级别,这部分就能够打印)<br />我们所有的sql都依赖于xml的setall,如果把这部分的方法设置成debug级别,那么sql部分的就能设置成debug了<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451301715-ce461146-0fb1-4316-9474-a3cbd4e46e66.png#align=left&display=inline&height=207&originHeight=230&originWidth=924&status=done&width=831)<br />要找到这个得把整个路径写全<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451301802-ac7f9cbf-2e32-48ec-ad52-cbca153f87fc.png#align=left&display=inline&height=244&originHeight=258&originWidth=877&status=done&width=831)<br />如此重新运行可看出只打印出sql语句相关的<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451301874-f8cdbc12-a53c-4462-aaa3-2e0bbfab4b10.png#align=left&display=inline&height=327&originHeight=308&originWidth=782&status=done&width=831)<br />但注意这是方法级别的设置,我们一个项目里可能有很多方法,这种方法就不适用了,我们还可以设置成类的级别<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451301989-f95ef0aa-17fe-4dd3-b5fd-267c9a644be4.png#align=left&display=inline&height=85&originHeight=77&originWidth=749&status=done&width=831)<br />设置成这个表示其下所有方法都试试debug<br />还有更大的包级别<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451302051-37001b11-cd2b-47ec-9233-95ad30533ccd.png#align=left&display=inline&height=110&originHeight=75&originWidth=567&status=done&width=831)<br />即便再有一个xml文件,也是可以控制的
<a name="fd2d0efe"></a>
#### 编码方式调整
我们这时候如果写中文会出现<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451302115-0ad74f1b-ffc7-4641-870d-efb8395ebaa7.png#align=left&display=inline&height=81&originHeight=54&originWidth=263&status=done&width=395)<br />因为这里编码方式还是iso,我们得调整一下它的编码方式<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451302181-53af4ce6-ae2a-4d39-8491-f105776d78c0.png#align=left&display=inline&height=686&originHeight=736&originWidth=730&status=done&width=680)<br />设置<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451302252-cf88ecab-589d-4511-89ff-2ec15feb0142.png#align=left&display=inline&height=359&originHeight=328&originWidth=759&status=done&width=831)<br />现在就可以设置中文了<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451302326-667c7774-8169-47bc-907c-39c7036816b6.png#align=left&display=inline&height=322&originHeight=226&originWidth=584&status=done&width=831)
<a name="918d69c4"></a>
## 通过<settings>开启 log4j 的支持
通过setting可以对mybatis做一些修改,如缓存,延迟加载,日志实现(一般都会有个默认值)<br />日志:默认为没设置,自动发现,即我没配置,但我写好了配置文件,导入了log4j的jar包,那么它就默认设置为log4j的方式<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451302391-eba01a39-9fc0-4342-92b1-65a933c7262b.png#align=left&display=inline&height=152&originHeight=156&originWidth=855&status=done&width=831)<br />当然也可以显式声明一下(其实加不加都一样,你准备声明它设置什么)<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451302467-5570e6bb-91af-4981-bbd4-9db8d20ef419.png#align=left&display=inline&height=324&originHeight=354&originWidth=908&status=done&width=831)<br />注意这个标签只能设置在environments之前,放后面就报错<br />明显这里有个顺序问题<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451302545-91d8e6fb-9dc7-49e4-8436-65be2e0d99f3.png#align=left&display=inline&height=199&originHeight=201&originWidth=840&status=done&width=831)<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561451302621-566a2675-d89e-42a5-a5d4-ee40538bed4a.png#align=left&display=inline&height=319&originHeight=301&originWidth=784&status=done&width=831)<br /><settings>用于设置 MyBatis 在运行时的行为方式, 例如:<br />缓存, 延迟加载, 日志等.<br /><!-- settings标签 --><br /><settings><br /><!-- 设置MyBatis使用log4j日志支持 --><br /><setting name="logImpl" value="LOG4J"/><br /></settings>
<a name="cffc24bb"></a>
## 局部调整日志级别, 定制日志的输出
# 提高整体日志级别<br />log4j.rootCategory=ERROR, CONSOLE<br /># 单独设置SQL语句的输出级别为DEBUG级别<br /># 方法级别<br /># log4j.logger.com.bjsxt.mapper.UserMapper.selAll=DEBUG<br /># 类级别<br /># log4j.logger.com.bjsxt.mapper.UserMapper=DEBUG<br /># 包级别<br />log4j.logger.com.bjsxt.mapper=DEBUG
