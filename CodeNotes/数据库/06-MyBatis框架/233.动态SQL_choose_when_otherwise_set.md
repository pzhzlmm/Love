# 233.动态SQL_choose_when_otherwise_set

<a name="33f5ff1c"></a>
# 动态 SQL
<a name="90135f12"></a>
## <choose><when><otherwise>
这是一套标签, 功能类似于 switch...case...<br />多分支条件判断,有个效果是永远只有一个条件成立(有一个成立了就不会看后面的了)<br />Otherwise相当于default,默认的<br /><select id="sel" resultType="user"><br />select * from t_user<br /><where><br /><choose><br /><when test="username != null and username != ''"><br />and username = #{username}<br /></when><br /><when test="password != null and password != ''"><br />and password = #{password}<br /></when><br /><otherwise><br />and 1=1<br /></otherwise><br /></choose><br /></where><br /></select>
<a name="bb849bdf"></a>
## <set>
现在我们来写个修改<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561545149233-e44f1820-447a-4dd9-97a4-b3548512ef74.png#align=left&display=inline&height=253&originHeight=366&originWidth=636&status=done&width=440)<br />给某个属性赋值了才改,没赋值就相当于啥都没改,所以update这个语句也是在动态变化的,有有户名,连用户名也改,有密码,连密码也改<br />设置配置文件<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561545149318-c1c47876-8960-4939-b90f-cf95b2b80734.png#align=left&display=inline&height=360&originHeight=309&originWidth=713&status=done&width=831)<br />具体set什么后面写(和where类型,有条件生成set,没条件不会生成)<br />用于维护 update 语句中的 set 子句. 功能如下:<br />a)满足条件时, 会自动添加 set 关键字<br />b)会去除 set 子句中多余的逗号<br />c)不满足条件时, 不会生成 set 关键字<br />set后写上where条件,<br />想我们在接口中写的是一个对象<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561545149396-a575fc45-731b-416b-83cd-4b59a64b89fd.png#align=left&display=inline&height=491&originHeight=348&originWidth=589&status=done&width=831)<br />对象取值通过属性名就可以取了,所以这里就不用加那个注解直接写属性了@@@<br />如果加了注解相当于封装了一个map集合,要通过一个key找到userr对象,拿到对象才能.属性会很麻烦,不如直接通过属性获取@@@<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561545149476-45340528-d908-44d6-8b62-92b761016e22.png#align=left&display=inline&height=306&originHeight=262&originWidth=711&status=done&width=831)<br />Set中间写什么内容呢<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561545149555-11701381-0183-4391-beb9-5ea544e674d8.png#align=left&display=inline&height=339&originHeight=360&originWidth=882&status=done&width=831)<br />因为不确定哪个会成立<br />测试<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561545149684-703be871-5715-4147-9cd6-d06c9acb4548.png#align=left&display=inline&height=367&originHeight=432&originWidth=979&status=done&width=831)<br />结果<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561545149759-28dc5376-1e64-459e-b091-fc5ecba361d1.png#align=left&display=inline&height=136&originHeight=168&originWidth=1029&status=done&width=831)<br />但如果两个都没有sql语句就会报错<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561545149862-b12d0f55-5da3-42cd-a9d5-5a5ecd8c380d.png#align=left&display=inline&height=379&originHeight=370&originWidth=811&status=done&width=831)<br />Id又改成原来的@@@<br />![](https://cdn.nlark.com/yuque/0/2019/png/349894/1561545149977-e8a7d9cd-e6f2-4c8f-abf4-535e620d36b8.png#align=left&display=inline&height=173&originHeight=174&originWidth=835&status=done&width=831)<br />这样即便为空也不会出错<br />int updUser(User user);<br /><update id="updUser" parameterType="user"><br />update t_user<br /><set><br />id=#{id}, <!-- 防止所有条件不成立时的语法错误 --><br /><if test="username != null and username != ''"><br />username=#{username},<br /></if><br /><if test="password != null and password != ''"><br />password=#{password},<br /></if><br /></set><br />where id=#{id}<br /></update>
